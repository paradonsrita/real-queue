@using System.Collections.Generic
@using QMS.Models

<table class="table mb-5">
    <thead>
        <tr>
            <th>Queue Number</th>
            <th>Queue Type</th>
            <th>Counter</th>
        </tr>
    </thead>
    <tbody>
        @if (Queue != null && Queue.Any())
        {
            // กรองคิวที่มีสถานะ "in process" และ Source ตรงกับที่กำหนด
            var filteredQueue = Queue
                        .Where(q => q.QueueStatus == "in process" && q.Source == Source)
                        .OrderByDescending(q => q.queue_id)
                        .Take(3)
                        .ToList();
            var queueCount = filteredQueue.Count;

            @foreach (var stat in filteredQueue)
            {
                <tr>
                    <td>@(string.IsNullOrEmpty(stat.QueueNumber) ? "-" : stat.QueueNumber)</td>
                    <td>@(queueTypeMappings.ContainsKey(stat.QueueType) ? queueTypeMappings[stat.QueueType] : stat.QueueType)</td>
                    <td>@(stat.Counter.HasValue ? stat.Counter.ToString() : "-")</td>
                </tr>
            }
            @if (queueCount < 3)
            {
                var emptyRows = 3 - queueCount;

                @for (int i = 0; i < emptyRows; i++)
                {
                    <tr class="empty-row">
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                }
            }
        }
        
    </tbody>
</table>

@code {
    [Parameter]
    public string Source { get; set; }

    [Parameter]
    public List<QueueModel> Queue { get; set; }


    private Dictionary<string, string> queueTypeMappings = new Dictionary<string, string>
    {
        { "Finance", "เปิด-ปิดบัญชีฝากถอน" },
        { "Loan", "ขอกู้ จ่ายเงินกู้" },
        { "Shares", "สมัครสมาชิก ลาออก ซื้อ-ถอนหุ้น รับชำระหนี้" },
        { "Other", "อื่นๆ"}
    };
}
